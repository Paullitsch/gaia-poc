<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>GAIA â€“ Mission Control</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='26' font-size='28'>ğŸ§¬</text></svg>">
<style>
/* â•â•â•â•â•â•â• RESET & TOKENS â•â•â•â•â•â•â• */
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0c;--bg2:#101014;
  --surface:#141418;--surface2:#1a1a20;--surface3:#222228;
  --border:rgba(255,255,255,.06);--border2:rgba(255,255,255,.1);
  --text:#eeeef0;--text2:#9898a4;--text3:#5c5c6a;
  --accent:#7c6aef;--accent2:#9d8df7;--accent-dim:rgba(124,106,239,.1);
  --green:#34d399;--green-dim:rgba(52,211,153,.1);
  --red:#f87171;--red-dim:rgba(248,113,113,.1);
  --yellow:#fbbf24;--yellow-dim:rgba(251,191,36,.1);
  --cyan:#22d3ee;--cyan-dim:rgba(34,211,238,.1);
  --orange:#fb923c;--pink:#f472b6;
  --radius:12px;--radius-sm:8px;--radius-xs:6px;
  --shadow:0 1px 3px rgba(0,0,0,.3),0 1px 2px rgba(0,0,0,.2);
  --font:-apple-system,BlinkMacSystemFont,'Inter','Segoe UI',system-ui,sans-serif;
  --mono:'JetBrains Mono','SF Mono','Fira Code',monospace;
}
html{-webkit-text-size-adjust:100%;scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:var(--font);font-size:14px;line-height:1.5;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}

/* â•â•â•â•â•â•â• AUTH OVERLAY â•â•â•â•â•â•â• */
#auth-overlay{position:fixed;inset:0;background:var(--bg);z-index:1000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px}
#auth-overlay.hidden{display:none}
.auth-logo{font-size:3.5rem;filter:drop-shadow(0 0 24px rgba(124,106,239,.3))}
.auth-title{font-size:1.4rem;font-weight:700;color:var(--text)}
.auth-sub{color:var(--text3);font-size:.85rem}
.auth-input{background:var(--surface2);border:1px solid var(--border2);border-radius:var(--radius);padding:14px 18px;color:var(--text);font-size:1rem;width:min(320px,85vw);outline:none;transition:border .2s;font-family:var(--font)}
.auth-input:focus{border-color:var(--accent)}
.auth-input::placeholder{color:var(--text3)}
.auth-btn{background:var(--accent);color:#fff;border:none;border-radius:var(--radius);padding:14px 36px;font-size:.95rem;cursor:pointer;font-weight:600;transition:all .2s;font-family:var(--font)}
.auth-btn:hover{opacity:.9;transform:translateY(-1px)}
.auth-btn:active{transform:translateY(0)}
#auth-error{color:var(--red);font-size:.8rem;min-height:1.2rem}

/* â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• */
header{display:flex;align-items:center;justify-content:space-between;padding:0 20px;height:56px;background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{font-size:1.3rem}
.logo h1{font-size:1rem;font-weight:700;color:var(--text);letter-spacing:-.02em}
.logo h1 span{color:var(--accent2)}
.header-right{display:flex;align-items:center;gap:16px;font-size:.75rem;color:var(--text3)}
.header-right .sep{width:1px;height:16px;background:var(--border2)}
.conn-indicator{display:flex;align-items:center;gap:5px}
.conn-dot{width:7px;height:7px;border-radius:50%;transition:all .3s}
.conn-dot.on{background:var(--green);box-shadow:0 0 8px rgba(52,211,153,.4)}
.conn-dot.off{background:var(--red);box-shadow:0 0 8px rgba(248,113,113,.4)}

/* â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â• */
.container{max-width:1440px;margin:0 auto;padding:16px 20px}

/* â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â• */
.tabs{display:flex;gap:2px;padding:0 20px;background:var(--surface);border-bottom:1px solid var(--border);overflow-x:auto;scrollbar-width:none;-webkit-overflow-scrolling:touch}
.tabs::-webkit-scrollbar{display:none}
.tab{padding:12px 16px;font-size:.8rem;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;font-weight:500;transition:all .2s;white-space:nowrap;flex-shrink:0;user-select:none}
.tab:hover{color:var(--text2)}
.tab.active{color:var(--accent2);border-bottom-color:var(--accent)}
.tab-content{display:none;padding-top:20px}
.tab-content.active{display:block;animation:fadeIn .2s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â•â•â•â•â• STATS ROW â•â•â•â•â•â•â• */
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;text-align:center;transition:border-color .2s}
.stat-card:hover{border-color:var(--border2)}
.stat-val{font-size:2rem;font-weight:800;font-variant-numeric:tabular-nums;line-height:1.1;letter-spacing:-.02em}
.stat-label{font-size:.7rem;color:var(--text3);margin-top:4px;text-transform:uppercase;letter-spacing:.06em;font-weight:500}
.stat-sub{font-size:.7rem;color:var(--text3);margin-top:6px}

/* â•â•â•â•â•â•â• GRID â•â•â•â•â•â•â• */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.full-width{grid-column:1/-1}

/* â•â•â•â•â•â•â• CARDS â•â•â•â•â•â•â• */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:border-color .2s}
.card:hover{border-color:var(--border2)}
.card-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;min-height:52px}
.card-header h2{font-size:.75rem;text-transform:uppercase;letter-spacing:.06em;color:var(--text2);font-weight:600;display:flex;align-items:center;gap:8px}
.card-body{padding:20px}

/* â•â•â•â•â•â•â• BADGES â•â•â•â•â•â•â• */
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:999px;font-size:.65rem;font-weight:600;letter-spacing:.02em}
.badge-idle{background:var(--green-dim);color:var(--green)}
.badge-busy{background:var(--cyan-dim);color:var(--cyan)}
.badge-offline{background:var(--red-dim);color:var(--red)}
.badge-queued{background:var(--accent-dim);color:var(--accent2)}
.badge-running{background:var(--cyan-dim);color:var(--cyan)}
.badge-completed{background:var(--green-dim);color:var(--green)}
.badge-failed{background:var(--red-dim);color:var(--red)}
.badge-cancelled{background:var(--yellow-dim);color:var(--yellow)}
.badge-timed_out{background:var(--yellow-dim);color:var(--orange)}
.badge-gpu{background:var(--cyan-dim);color:var(--cyan)}
.badge-cpu{background:var(--yellow-dim);color:var(--yellow)}
.badge-backprop{background:var(--red-dim);color:var(--red)}
.badge-gradfree{background:var(--green-dim);color:var(--green)}

/* â•â•â•â•â•â•â• WORKERS â•â•â•â•â•â•â• */
.worker-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:10px}
.worker-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;transition:all .2s;position:relative;overflow:hidden}
.worker-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}
.worker-card.busy::before{background:var(--cyan)}
.worker-card.idle::before{background:var(--green)}
.worker-card.offline::before{background:var(--red)}
.worker-card.offline{opacity:.45}
.worker-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.worker-name{font-weight:600;font-size:.9rem;display:flex;align-items:center;gap:8px}
.worker-meta{display:grid;grid-template-columns:auto 1fr;gap:4px 12px;font-size:.75rem}
.worker-meta .k{color:var(--text3)}
.worker-meta .v{color:var(--text2)}
.pulse{width:8px;height:8px;border-radius:50%;display:inline-block;flex-shrink:0}
.pulse.live{background:var(--green);animation:pulse 2s infinite}
.pulse.stale{background:var(--yellow)}
.pulse.dead{background:var(--red)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* â•â•â•â•â•â•â• ENV TABS â•â•â•â•â•â•â• */
.env-tabs{display:flex;gap:0;margin-bottom:16px;border:1px solid var(--border);border-radius:var(--radius-sm);overflow-x:auto;scrollbar-width:none;background:var(--bg2)}
.env-tabs::-webkit-scrollbar{display:none}
.env-tab{padding:8px 16px;font-size:.75rem;color:var(--text3);cursor:pointer;font-weight:500;transition:all .2s;white-space:nowrap;flex-shrink:0;border-right:1px solid var(--border)}
.env-tab:last-child{border-right:none}
.env-tab:hover{color:var(--text2);background:rgba(255,255,255,.02)}
.env-tab.active{color:var(--cyan);background:var(--cyan-dim)}

/* â•â•â•â•â•â•â• TABLES â•â•â•â•â•â•â• */
.table-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;border-radius:var(--radius-sm)}
.table{width:100%;border-collapse:collapse;font-size:.8rem;min-width:600px}
.table th{text-align:left;padding:10px 14px;color:var(--text3);font-size:.65rem;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid var(--border);font-weight:600;background:var(--bg2)}
.table td{padding:10px 14px;border-bottom:1px solid var(--border)}
.table tbody tr{transition:background .15s}
.table tbody tr:hover{background:rgba(255,255,255,.02)}
.table tbody tr:last-child td{border-bottom:none}
.rank-1{color:var(--yellow);font-weight:700}
.rank-2{color:#c0c0c0;font-weight:600}
.rank-3{color:#cd7f32;font-weight:600}

/* â•â•â•â•â•â•â• PROGRESS BAR â•â•â•â•â•â•â• */
.progress-bar{height:6px;background:var(--bg);border-radius:3px;overflow:hidden;margin-top:6px}
.progress-fill{height:100%;border-radius:3px;transition:width .5s ease;background:linear-gradient(90deg,var(--accent),var(--cyan))}

/* â•â•â•â•â•â•â• CHARTS â•â•â•â•â•â•â• */
.chart-wrap{position:relative;width:100%;height:340px}
.chart-wrap canvas{width:100%!important;height:100%!important;touch-action:pan-y;border-radius:var(--radius-sm)}
.chart-hint{position:absolute;bottom:8px;right:12px;font-size:.65rem;color:var(--text3);pointer-events:none;opacity:.6}

/* â•â•â•â•â•â•â• SUBMIT FORM â•â•â•â•â•â•â• */
.form-row{display:flex;gap:10px;align-items:end;flex-wrap:wrap}
.form-group{display:flex;flex-direction:column;gap:4px}
.form-group label{font-size:.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:.04em;font-weight:500}
.form-select,.form-input{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--radius-xs);padding:10px 14px;color:var(--text);font-size:.8rem;outline:none;transition:border .2s;font-family:var(--font);min-width:0}
.form-select:focus,.form-input:focus{border-color:var(--accent)}
.form-select{cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%235c5c6a'%3E%3Cpath d='M2 4l4 4 4-4'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}
.form-select option{background:var(--surface);color:var(--text)}
.btn{border:none;border-radius:var(--radius-xs);padding:10px 24px;cursor:pointer;font-size:.8rem;font-weight:600;transition:all .15s;font-family:var(--font);display:inline-flex;align-items:center;gap:6px}
.btn:active{transform:scale(.98)}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:var(--accent2)}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--text2);padding:8px 14px;font-size:.75rem}
.btn-ghost:hover{background:rgba(255,255,255,.04);color:var(--text)}
.btn-ghost.active{background:var(--accent-dim);border-color:var(--accent);color:var(--accent2)}
.btn-danger{background:transparent;border:1px solid var(--border);color:var(--red);padding:6px 12px;font-size:.7rem}
.btn-danger:hover{background:var(--red-dim)}
.param-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:14px}
.param-grid .form-group{gap:3px}
.param-grid .form-input{padding:8px 12px}

/* â•â•â•â•â•â•â• JOBS â•â•â•â•â•â•â• */
.job-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px 16px;margin-bottom:8px;transition:all .2s;position:relative}
.job-card.running{border-left:3px solid var(--cyan)}
.job-card.queued{border-left:3px solid var(--accent)}
.job-top{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.job-info{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.job-id{font-family:var(--mono);color:var(--text3);font-size:.7rem}
.job-method{font-weight:600;font-size:.85rem}
.job-env{font-size:.7rem;color:var(--text3)}
.job-details{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:6px;font-size:.72rem}
.job-detail{display:flex;flex-direction:column;gap:1px}
.job-detail .k{color:var(--text3);font-size:.65rem;text-transform:uppercase;letter-spacing:.03em}
.job-detail .v{color:var(--text2);font-family:var(--mono);font-size:.75rem}
.section-label{font-size:.7rem;font-weight:600;color:var(--text3);margin:12px 0 6px;text-transform:uppercase;letter-spacing:.04em}

/* â•â•â•â•â•â•â• ACTIVITY LOG â•â•â•â•â•â•â• */
.activity-log{max-height:200px;overflow-y:auto;font-size:.72rem;font-family:var(--mono)}
.activity-entry{padding:5px 0;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:baseline}
.activity-time{color:var(--text3);min-width:55px;flex-shrink:0}

/* â•â•â•â•â•â•â• EMPTY STATE â•â•â•â•â•â•â• */
.empty{color:var(--text3);text-align:center;padding:32px 20px;font-size:.85rem}
.empty-icon{font-size:2rem;margin-bottom:8px;opacity:.5}

/* â•â•â•â•â•â•â• SCROLLBAR â•â•â•â•â•â•â• */
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--text3)}
::-webkit-scrollbar-track{background:transparent}

/* â•â•â•â•â•â•â• MOBILE â•â•â•â•â•â•â• */
@media(max-width:768px){
  .grid{grid-template-columns:1fr}
  .container{padding:12px}
  header{padding:0 12px;height:50px}
  .card-body{padding:14px}
  .card-header{padding:12px 14px}
  .chart-wrap{height:260px}
  .form-row{flex-direction:column;align-items:stretch}
  .form-row .form-group{width:100%}
  .form-row .btn-primary{width:100%}
  .stats-row{grid-template-columns:repeat(2,1fr);gap:8px}
  .stat-val{font-size:1.5rem}
  .stat-card{padding:14px}
  .worker-grid{grid-template-columns:1fr}
  .table{font-size:.72rem;min-width:520px}
  .table th,.table td{padding:8px 10px}
  .tab{padding:10px 14px;font-size:.75rem}
  .header-right .hide-mobile{display:none}
  .env-tab{padding:8px 12px;font-size:.7rem}
  .param-grid{grid-template-columns:repeat(2,1fr)}
  .job-details{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:380px){
  .stats-row{grid-template-columns:1fr 1fr}
  .param-grid{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• AUTH â•â•â•â•â•â•â• -->
<div id="auth-overlay">
  <div class="auth-logo">ğŸ§¬</div>
  <div class="auth-title">GAIA Mission Control</div>
  <div class="auth-sub">Decentralized Neuroevolution Platform</div>
  <input type="password" id="token-input" class="auth-input" placeholder="Enter auth token" autofocus>
  <div id="auth-error"></div>
  <button class="auth-btn" onclick="authenticate()">Connect</button>
</div>

<!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
<header>
  <div class="logo">
    <span class="logo-icon">ğŸ§¬</span>
    <h1>GAIA <span>Mission Control</span></h1>
  </div>
  <div class="header-right">
    <span class="hide-mobile">v0.10.0</span>
    <span class="hide-mobile sep"></span>
    <span class="hide-mobile">â± <strong id="uptime">â€”</strong></span>
    <div class="conn-indicator">
      <span class="conn-dot" id="conn-dot"></span>
      <span id="conn-text">â€¦</span>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â• -->
<div class="tabs">
  <div class="tab active" data-tab="benchmarks">ğŸ† Benchmarks</div>
  <div class="tab" data-tab="overview">âš¡ Overview</div>
  <div class="tab" data-tab="charts">ğŸ“Š Charts</div>
  <div class="tab" data-tab="history">ğŸ“‹ History</div>
  <div class="tab" data-tab="network">ğŸŒ Network</div>
</div>

<div class="container">

  <!-- â•â•â•â•â•â•â• TAB: BENCHMARKS â•â•â•â•â•â•â• -->
  <div class="tab-content active" id="tab-benchmarks">
    <div class="stats-row" id="stats-row">
      <div class="stat-card"><div class="stat-val" id="stat-workers">0</div><div class="stat-label">Workers</div></div>
      <div class="stat-card"><div class="stat-val" id="stat-jobs">0</div><div class="stat-label">Active Jobs</div></div>
      <div class="stat-card"><div class="stat-val" id="stat-completed">0</div><div class="stat-label">Completed</div></div>
      <div class="stat-card"><div class="stat-val" id="stat-envs">0</div><div class="stat-label">Environments</div></div>
    </div>

    <div class="grid">
      <!-- Submit -->
      <div class="card full-width">
        <div class="card-header"><h2>âš¡ Submit Experiment</h2></div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <label>Environment</label>
              <select id="env-select" class="form-select" style="min-width:180px">
                <optgroup label="ğŸ® Classic Control">
                  <option value="CartPole-v1">CartPole-v1</option>
                </optgroup>
                <optgroup label="ğŸš€ Discrete Control">
                  <option value="LunarLander-v3" selected>LunarLander-v3</option>
                </optgroup>
                <optgroup label="ğŸ¦¿ Continuous (CPU)">
                  <option value="BipedalWalker-v3">BipedalWalker-v3</option>
                </optgroup>
                <optgroup label="ğŸš€ GPU-Native Continuous">
                  <option value="Swimmer-v1">Swimmer-v1</option>
                  <option value="Pendulum-2Link">Pendulum-2Link</option>
                  <option value="Pendulum-3Link">Pendulum-3Link</option>
                  <option value="Pendulum-5Link">Pendulum-5Link</option>
                  <option value="Pendulum-10Link">Pendulum-10Link</option>
                  <option value="Pendulum-15Link">Pendulum-15Link</option>
                  <option value="Pendulum-20Link">Pendulum-20Link</option>
                </optgroup>
              </select>
            </div>
            <div class="form-group">
              <label>Method</label>
              <select id="method-select" class="form-select" onchange="updateMethodParams()" style="min-width:200px">
                <optgroup label="ğŸ§¬ Gradient-Free (GAIA)">
                  <option value="cma_es">CMA-ES</option>
                  <option value="openai_es">OpenAI-ES</option>
                  <option value="curriculum">Curriculum CMA-ES</option>
                  <option value="neuromod">Neuromod CMA-ES</option>
                  <option value="island_model">Island Model</option>
                  <option value="meta_learning">Meta-Learning</option>
                </optgroup>
                <optgroup label="ğŸš€ GPU Full-Episode">
                  <option value="gpu_full_cma_es">GPU CMA-ES</option>
                  <option value="gpu_full_openai_es">GPU OpenAI-ES</option>
                  <option value="gpu_full_benchmark">GPU Benchmark</option>
                </optgroup>
                <optgroup label="âš¡ Backprop Baseline">
                  <option value="ppo_baseline">PPO (Backprop)</option>
                </optgroup>
              </select>
            </div>
            <div class="form-group" style="justify-content:end">
              <button class="btn btn-primary" onclick="submitJob()">Submit âš¡</button>
            </div>
          </div>
          <div class="param-grid" id="method-params"></div>
        </div>
      </div>

      <!-- Leaderboard -->
      <div class="card full-width">
        <div class="card-header"><h2>ğŸ† Leaderboard</h2></div>
        <div class="card-body">
          <div class="env-tabs" id="bench-env-tabs">
            <div class="env-tab" data-env="CartPole-v1">ğŸ¯ CartPole</div>
            <div class="env-tab active" data-env="LunarLander-v3">ğŸš€ LunarLander</div>
            <div class="env-tab" data-env="BipedalWalker-v3">ğŸ¦¿ BipedalWalker</div>
            <div class="env-tab" data-env="Swimmer-v1">ğŸ› Swimmer</div>
            <div class="env-tab" data-env="Pendulum-2Link">ğŸ”— 2-Link</div>
            <div class="env-tab" data-env="Pendulum-3Link">ğŸ”— 3-Link</div>
            <div class="env-tab" data-env="Pendulum-5Link">ğŸ”— 5-Link</div>
            <div class="env-tab" data-env="Pendulum-10Link">ğŸ”— 10-Link</div>
            <div class="env-tab" data-env="Pendulum-15Link">ğŸ”— 15-Link</div>
            <div class="env-tab" data-env="Pendulum-20Link">ğŸ”— 20-Link</div>
          </div>
          <div id="leaderboard-body"><div class="empty"><div class="empty-icon">ğŸ”¬</div>Run experiments to see leaderboards</div></div>
        </div>
      </div>

      <!-- Learning Curves -->
      <div class="card full-width">
        <div class="card-header">
          <h2>ğŸ“ˆ Learning Curves</h2>
          <div style="display:flex;gap:6px;align-items:center">
            <button class="btn-ghost active" data-metric="best_ever" onclick="setMetric(this,'best_ever')">Best</button>
            <button class="btn-ghost" data-metric="mean" onclick="setMetric(this,'mean')">Mean</button>
            <span style="color:var(--text3);font-size:.65rem;margin-left:6px" id="chart1-info"></span>
          </div>
        </div>
        <div class="card-body">
          <div id="method-toggles" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px"></div>
          <div class="chart-wrap"><canvas id="learning-canvas"></canvas><div class="chart-hint">Scroll to zoom Â· Drag to pan Â· Double-click to reset</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• TAB: OVERVIEW â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tab-overview">
    <div class="grid">
      <div class="card">
        <div class="card-header">
          <h2>âš¡ Workers</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <label style="font-size:.7rem;color:var(--text3);cursor:pointer;display:flex;align-items:center;gap:5px">
              <input type="checkbox" id="show-offline" onchange="refresh()" style="accent-color:var(--accent)"> Offline
            </label>
            <span id="worker-count" class="badge badge-idle">0</span>
          </div>
        </div>
        <div class="card-body" id="workers-body"><div class="empty"><div class="empty-icon">âš¡</div>No workers connected</div></div>
      </div>
      <div class="card">
        <div class="card-header"><h2>ğŸ”¬ Active Jobs</h2><span id="job-count" class="badge badge-queued">0</span></div>
        <div class="card-body" id="jobs-body"><div class="empty"><div class="empty-icon">ğŸ”¬</div>No active jobs</div></div>
      </div>
      <div class="card full-width">
        <div class="card-header"><h2>ğŸ“Š Best Scores</h2></div>
        <div class="card-body"><div class="stats-row" id="best-scores"><div class="empty" style="grid-column:1/-1"><div class="empty-icon">ğŸ“Š</div>Run experiments to see scores</div></div></div>
      </div>
      <div class="card full-width">
        <div class="card-header"><h2>ğŸ“‹ Activity</h2><button class="btn-ghost" onclick="activityLog.length=0;renderActivity()">Clear</button></div>
        <div class="card-body"><div class="activity-log" id="activity-log"><div class="empty">Waiting for eventsâ€¦</div></div></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• TAB: CHARTS â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tab-charts">
    <div class="grid">
      <div class="card">
        <div class="card-header"><h2>ğŸ† Method Comparison</h2></div>
        <div class="card-body"><div class="chart-wrap" style="height:300px"><canvas id="comparison-canvas"></canvas></div></div>
      </div>
      <div class="card">
        <div class="card-header"><h2>ğŸ”¬ Convergence (Ïƒ)</h2></div>
        <div class="card-body"><div class="chart-wrap" style="height:300px"><canvas id="sigma-canvas"></canvas></div></div>
      </div>
      <div class="card full-width">
        <div class="card-header"><h2>ğŸ“Š Score Distribution</h2></div>
        <div class="card-body"><div class="chart-wrap" style="height:280px"><canvas id="dist-canvas"></canvas></div></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• TAB: HISTORY â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tab-history">
    <div class="card full-width">
      <div class="card-header">
        <h2>ğŸ“‹ Job History</h2>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <select id="history-env-filter" class="form-select" onchange="renderHistory()" style="font-size:.75rem;padding:6px 28px 6px 10px">
            <option value="all">All Environments</option>
            <option value="CartPole-v1">CartPole-v1</option>
            <option value="LunarLander-v3">LunarLander-v3</option>
            <option value="BipedalWalker-v3">BipedalWalker-v3</option>
            <option value="Swimmer-v1">Swimmer-v1</option>
            <option value="Pendulum-2Link">Pendulum-2Link</option>
            <option value="Pendulum-3Link">Pendulum-3Link</option>
            <option value="Pendulum-5Link">Pendulum-5Link</option>
            <option value="Pendulum-10Link">Pendulum-10Link</option>
            <option value="Pendulum-15Link">Pendulum-15Link</option>
            <option value="Pendulum-20Link">Pendulum-20Link</option>
          </select>
          <button class="btn-ghost" onclick="downloadAllCSV()">â¬‡ CSV</button>
          <button class="btn-ghost" onclick="downloadSummaryJSON()">â¬‡ JSON</button>
        </div>
      </div>
      <div class="card-body" id="history-body"><div class="empty"><div class="empty-icon">ğŸ“‹</div>No jobs yet</div></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• TAB: NETWORK â•â•â•â•â•â•â• -->
  <div class="tab-content" id="tab-network">
    <div class="card full-width">
      <div class="card-header"><h2>ğŸŒ GAIA P2P Network</h2></div>
      <div class="card-body" id="network-body"><div class="empty"><div class="empty-icon">ğŸŒ</div>Loading network statusâ€¦</div></div>
    </div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â• CONFIG â•â•â•â•â•â•â•
const BENCHMARKS = {
  'CartPole-v1':     { threshold: 475, obs: 4,  act: 2, type: 'discrete',   emoji: 'ğŸ¯', gpu: true },
  'LunarLander-v3':  { threshold: 200, obs: 8,  act: 4, type: 'discrete',   emoji: 'ğŸš€', gpu: true },
  'BipedalWalker-v3':{ threshold: 300, obs: 24, act: 4, type: 'continuous', emoji: 'ğŸ¦¿', gpu: false },
  'Swimmer-v1':      { threshold: 360, obs: 8,  act: 2, type: 'continuous', emoji: 'ğŸ›', gpu: true },
  'Pendulum-2Link':  { threshold: 400, obs: 6,  act: 2, type: 'continuous', emoji: 'ğŸ”—', gpu: true },
  'Pendulum-3Link':  { threshold: 600, obs: 9,  act: 3, type: 'continuous', emoji: 'ğŸ”—', gpu: true },
  'Pendulum-5Link':  { threshold:1000, obs: 15, act: 5, type: 'continuous', emoji: 'ğŸ”—', gpu: true },
  'Pendulum-10Link': { threshold:2000, obs: 30, act: 10, type: 'continuous', emoji: 'ğŸ”—', gpu: true },
  'Pendulum-15Link': { threshold:3000, obs: 45, act: 15, type: 'continuous', emoji: 'ğŸ”—', gpu: true },
  'Pendulum-20Link': { threshold:4000, obs: 60, act: 20, type: 'continuous', emoji: 'ğŸ”—', gpu: true },
};

const METHOD_NAMES = {
  cma_es:'CMA-ES', openai_es:'OpenAI-ES', curriculum:'Curriculum',
  neuromod:'Neuromod', island_model:'Island Model', meta_learning:'Meta-Learning',
  ppo_baseline:'PPO (Backprop)', gpu_full_cma_es:'GPU CMA-ES',
  gpu_full_openai_es:'GPU OpenAI-ES', gpu_full_benchmark:'GPU Benchmark',
  neuromod_island:'Neuromod Island', island_advanced:'Island Advanced',
  meta_learning_pure:'Pure Meta', scaling_test:'Scaling', hybrid_cma_ff:'Hybrid CMA+FF',
  indirect_encoding:'Indirect Enc',
};
const BACKPROP_METHODS = new Set(['ppo_baseline']);
const GPU_METHODS = new Set(['gpu_full_cma_es','gpu_full_openai_es','gpu_full_benchmark']);

// â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•
let TOKEN='', serverStart=null, currentBenchEnv='LunarLander-v3';
const activityLog=[], MAX_LOG=80;
let prevWorkerIds=new Set(), prevJobStatuses={};
let allJobData={}, allJobs=[];
let chartZoom={x0:0,x1:1,dragging:false,startX:0,yOff:0};
let hiddenMethods=new Set();
let currentMetric='best_ever';
const COLORS=['#7c6aef','#22d3ee','#34d399','#fbbf24','#fb923c','#f472b6','#f87171','#a78bfa','#14b8a6','#f43f5e','#60a5fa','#c084fc'];

// â•â•â•â•â•â•â• AUTH â•â•â•â•â•â•â•
function authenticate(){
  TOKEN=document.getElementById('token-input').value.trim();
  if(!TOKEN){document.getElementById('auth-error').textContent='Token required';return}
  fetch('/api/status',{headers:{'Authorization':'Bearer '+TOKEN}})
    .then(r=>{if(!r.ok)throw 0;return r.json()})
    .then(()=>{document.getElementById('auth-overlay').classList.add('hidden');localStorage.setItem('gaia_token',TOKEN);startPolling()})
    .catch(()=>{document.getElementById('auth-error').textContent='Invalid token'});
}
document.getElementById('token-input').addEventListener('keydown',e=>{if(e.key==='Enter')authenticate()});
window.addEventListener('DOMContentLoaded',()=>{const s=localStorage.getItem('gaia_token');if(s){TOKEN=s;document.getElementById('token-input').value=s;authenticate()}});

// â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  document.getElementById('tab-'+t.dataset.tab).classList.add('active');
  if(t.dataset.tab==='charts')requestAnimationFrame(drawAllCharts);
  if(t.dataset.tab==='benchmarks')requestAnimationFrame(()=>{renderLeaderboard();drawLearningCurves()});
  if(t.dataset.tab==='history')renderHistory();
}));
document.querySelectorAll('#bench-env-tabs .env-tab').forEach(t=>t.addEventListener('click',()=>{
  document.querySelectorAll('#bench-env-tabs .env-tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  currentBenchEnv=t.dataset.env;
  renderLeaderboard();drawLearningCurves();
}));

// â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•
function esc(s){const d=document.createElement('div');d.textContent=s||'';return d.innerHTML}
function setHtml(el,html){const scrolls=new Map();el.querySelectorAll('.table-wrap').forEach((s,i)=>{if(s.scrollLeft)scrolls.set(i,s.scrollLeft)});el.innerHTML=html;el.querySelectorAll('.table-wrap').forEach((s,i)=>{if(scrolls.has(i))s.scrollLeft=scrolls.get(i)})}
function timeSince(iso){if(!iso)return'â€”';const s=Math.floor((Date.now()-new Date(iso).getTime())/1000);if(s<0)return'now';if(s<60)return s+'s ago';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago'}
function dur(a,b){if(!a)return'â€”';const s=Math.floor(((b?new Date(b):new Date).getTime()-new Date(a).getTime())/1000);if(s<0)return'â€”';if(s<60)return s+'s';if(s<3600)return Math.floor(s/60)+'m '+s%60+'s';return Math.floor(s/3600)+'h '+Math.floor(s%3600/60)+'m'}
function fmtTime(t){if(!t)return'â€”';return new Date(t).toLocaleTimeString('de-AT',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false})}
function fmtNum(n){if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return(n/1e3).toFixed(1)+'K';return n.toString()}
function addLog(m,ts){const d=ts?new Date(ts):new Date();activityLog.unshift({ts:d.getTime(),time:d.toLocaleTimeString('en',{hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'}),msg:m});activityLog.sort((a,b)=>b.ts-a.ts);if(activityLog.length>MAX_LOG)activityLog.pop()}
function resolveEnv(j){return j.environment}
function methodType(key){if(BACKPROP_METHODS.has(key))return'backprop';if(GPU_METHODS.has(key))return'gpu';return'gradfree'}
function methodTypeBadge(key){const t=methodType(key);if(t==='backprop')return'<span class="badge badge-backprop">Backprop</span>';if(t==='gpu')return'<span class="badge badge-gpu">GPU</span>';return'<span class="badge badge-gradfree">Grad-Free</span>'}

// â•â•â•â•â•â•â• POLLING â•â•â•â•â•â•â•
function startPolling(){refresh();setInterval(refresh,3000)}

async function refresh(){
  try{
    const r=await fetch('/api/status',{headers:{'Authorization':'Bearer '+TOKEN}});
    if(!r.ok)throw 0;
    const d=await r.json();
    document.getElementById('conn-dot').className='conn-dot on';
    document.getElementById('conn-text').textContent='Connected';
    if(d.server_start_time)serverStart=new Date(d.server_start_time);
    if(serverStart){const s=Math.floor((Date.now()-serverStart)/1000),h=Math.floor(s/3600),m=Math.floor(s%3600/60);document.getElementById('uptime').textContent=h>0?h+'h '+m+'m':m+'m'}
    allJobs=d.jobs||[];

    // Activity detection
    const cw=new Set((d.workers||[]).map(w=>w.id));
    for(const w of d.workers||[])if(!prevWorkerIds.has(w.id))addLog('ğŸŸ¢ <b>'+esc(w.name)+'</b> connected',w.registered_at);
    prevWorkerIds=cw;
    for(const j of d.jobs||[]){const p=prevJobStatuses[j.id];if(!p&&j.status==='queued')addLog('ğŸ“¤ <b>'+esc(j.method)+'</b> queued on '+esc(j.environment),j.created_at);if(p!==j.status){if(j.status==='running')addLog('â–¶ï¸ <b>'+esc(j.method)+'</b> started');if(j.status==='completed')addLog('âœ… <b>'+esc(j.method)+'</b> completed');if(j.status==='failed')addLog('âŒ <b>'+esc(j.method)+'</b> failed');if(j.status==='cancelled')addLog('ğŸš« <b>'+esc(j.method)+'</b> cancelled')}prevJobStatuses[j.id]=j.status}

    // Stats
    const workers=d.workers||[];
    const onlineW=workers.filter(w=>(Date.now()-new Date(w.last_heartbeat))/1000<60);
    const runJ=allJobs.filter(j=>j.status==='running'||j.status==='queued');
    const doneJ=allJobs.filter(j=>j.status==='completed');
    const envSet=new Set(allJobs.map(j=>j.environment));
    document.getElementById('stat-workers').textContent=onlineW.length;
    document.getElementById('stat-jobs').textContent=runJ.length;
    document.getElementById('stat-completed').textContent=doneJ.length;
    document.getElementById('stat-envs').textContent=envSet.size;

    renderWorkers(workers);
    renderJobs(allJobs);
    renderActivity();
    await fetchResults(allJobs);
    renderBestScores();
    renderLeaderboard();
    if(document.getElementById('tab-benchmarks').classList.contains('active'))drawLearningCurves();
    if(document.getElementById('tab-charts').classList.contains('active'))drawAllCharts();
    if(document.getElementById('tab-network')?.classList.contains('active'))renderNetwork();
    if(document.getElementById('tab-history')?.classList.contains('active'))renderHistory();
  }catch(e){document.getElementById('conn-dot').className='conn-dot off';document.getElementById('conn-text').textContent='Disconnected'}
}

// â•â•â•â•â•â•â• WORKERS â•â•â•â•â•â•â•
function renderWorkers(ws){
  const el=document.getElementById('workers-body');
  const showOffline=document.getElementById('show-offline').checked;
  const on=ws.filter(w=>(Date.now()-new Date(w.last_heartbeat))/1000<60);
  const off=ws.filter(w=>(Date.now()-new Date(w.last_heartbeat))/1000>=60);
  document.getElementById('worker-count').textContent=on.length+' online';
  const visible=showOffline?ws:on;
  if(!visible.length){el.innerHTML='<div class="empty"><div class="empty-icon">âš¡</div>No workers connected<br><code style="font-size:.7rem;color:var(--text3);margin-top:8px;display:inline-block">gaia-worker --server URL --token TOKEN --name NAME</code></div>';return}
  let h='<div class="worker-grid">';
  for(const w of visible){
    const age=(Date.now()-new Date(w.last_heartbeat))/1000;
    const pc=age<15?'live':age<60?'stale':'dead';
    const sc=age>=60?'offline':w.status==='busy'?'busy':'idle';
    const gpu=w.gpu&&typeof w.gpu==='object'?(w.gpu.name||'CPU'):(w.gpu||'CPU');
    const gpuMem=w.gpu&&w.gpu.memory_mb?Math.round(w.gpu.memory_mb/1024)+'GB':'';
    const ver=w.version?'v'+w.version:'â€”';
    const disabled=w.enabled===false;
    h+=`<div class="worker-card ${sc}">
      <div class="worker-top">
        <div class="worker-name"><span class="pulse ${pc}"></span> ${esc(w.name)}</div>
        <div style="display:flex;gap:6px;align-items:center">
          <span class="badge badge-${sc}">${disabled?'disabled':sc}</span>
          <button class="btn-ghost" onclick="toggleWorker('${w.id}')" title="${disabled?'Enable':'Disable'}" style="padding:4px 8px">${disabled?'â–¶':'â¸'}</button>
        </div>
      </div>
      <div class="worker-meta">
        <span class="k">GPU</span><span class="v">${esc(gpu)} ${gpuMem}</span>
        <span class="k">Version</span><span class="v" style="color:var(--accent2)">${ver}</span>
        <span class="k">Heartbeat</span><span class="v">${timeSince(w.last_heartbeat)}</span>
        ${w.current_job?'<span class="k">Job</span><span class="v" style="color:var(--cyan)">'+w.current_job.slice(0,8)+'</span>':''}
      </div>
    </div>`;
  }
  el.innerHTML=h+'</div>';
}

// â•â•â•â•â•â•â• JOBS â•â•â•â•â•â•â•
function renderJobs(jobs){
  const el=document.getElementById('jobs-body');
  const run=jobs.filter(j=>j.status==='running'),que=jobs.filter(j=>j.status==='queued');
  document.getElementById('job-count').textContent=run.length+que.length;
  let h='';
  if(run.length){
    h+='<div class="section-label">â–¶ Running</div>';
    for(const j of run){
      const d=allJobData[j.id];
      const maxEvals=j.max_evals||j.params?.max_evals||0;
      const curEvals=d&&d.points.length?Math.max(...d.points.map(p=>p.evals)):0;
      const pct=maxEvals>0?Math.min(100,Math.round(curEvals/maxEvals*100)):0;
      const bestScore=d&&d.points.length?Math.max(...d.points.map(p=>p.best_ever)).toFixed(1):'â€”';
      h+=`<div class="job-card running">
        <div class="job-top">
          <div class="job-info">
            <span class="job-id">${j.id.slice(0,8)}</span>
            <span class="job-method">${esc(j.method)}</span>
            ${methodTypeBadge(j.method)}
            <span class="job-env">${esc(j.environment)}</span>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <span style="font-size:.8rem;font-weight:700;color:var(--cyan)">${bestScore}</span>
            <button class="btn-danger" onclick="cancelJob('${j.id}')">Cancel</button>
          </div>
        </div>
        ${maxEvals>0?`<div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
        <div style="display:flex;justify-content:space-between;font-size:.65rem;color:var(--text3);margin-top:4px">
          <span>${fmtNum(curEvals)} / ${fmtNum(maxEvals)} evals</span>
          <span>${pct}% Â· ${dur(j.started_at)}</span>
        </div>`:''}
        <div class="job-details">
          ${Object.entries(j.params||{}).filter(([k])=>k!=='max_evals'&&k!=='eval_episodes').map(([k,v])=>`<div class="job-detail"><span class="k">${esc(k)}</span><span class="v">${v}</span></div>`).join('')}
        </div>
      </div>`;
    }
  }
  if(que.length){
    h+=`<div class="section-label">â³ Queue (${que.length})</div>`;
    for(const j of que){
      h+=`<div class="job-card queued">
        <div class="job-top">
          <div class="job-info">
            <span class="job-id">${j.id.slice(0,8)}</span>
            <span class="job-method">${esc(j.method)}</span>
            ${methodTypeBadge(j.method)}
            <span class="job-env">${esc(j.environment)}</span>
          </div>
          <button class="btn-danger" onclick="cancelJob('${j.id}')">Cancel</button>
        </div>
        <div class="job-details">
          ${j.max_evals?`<div class="job-detail"><span class="k">Max Evals</span><span class="v">${fmtNum(j.max_evals)}</span></div>`:''}
          ${Object.entries(j.params||{}).filter(([k])=>k!=='max_evals'&&k!=='eval_episodes').map(([k,v])=>`<div class="job-detail"><span class="k">${esc(k)}</span><span class="v">${v}</span></div>`).join('')}
        </div>
      </div>`;
    }
  }
  if(!h)h='<div class="empty"><div class="empty-icon">ğŸ”¬</div>No active jobs</div>';
  el.innerHTML=h;
}

function renderActivity(){
  const el=document.getElementById('activity-log');
  if(!activityLog.length){el.innerHTML='<div class="empty">Waiting for eventsâ€¦</div>';return}
  el.innerHTML=activityLog.slice(0,30).map(e=>`<div class="activity-entry"><span class="activity-time">${e.time}</span><span>${e.msg}</span></div>`).join('');
}

// â•â•â•â•â•â•â• RESULTS â•â•â•â•â•â•â•
async function fetchResults(jobs){
  for(const j of jobs.filter(j=>j.status==='running'||j.status==='completed')){
    try{
      const r=await fetch(`/api/results/${j.id}`,{headers:{'Authorization':'Bearer '+TOKEN}});
      if(!r.ok)continue;
      const d=await r.json();
      const pts=(d.results||[]).map(row=>({
        gen:row.generation,
        best:parseFloat(row.data?.best||0),
        best_ever:parseFloat(row.data?.best_ever||row.data?.best||0),
        mean:parseFloat(row.data?.mean||0),
        sigma:parseFloat(row.data?.sigma||0),
        evals:parseInt((row.data?.evals||'0').toString().replace(/,/g,'')),
        time:parseFloat(row.data?.time||0),
      })).sort((a,b)=>a.gen-b.gen);
      allJobData[j.id]={method:j.method,environment:resolveEnv(j),status:j.status,points:pts,started_at:j.started_at,completed_at:j.completed_at,params:j.params};
    }catch(e){}
  }
}

// â•â•â•â•â•â•â• LEADERBOARD â•â•â•â•â•â•â•
function renderLeaderboard(){
  const el=document.getElementById('leaderboard-body');
  const bench=BENCHMARKS[currentBenchEnv];
  if(!bench){el.innerHTML='<div class="empty">Unknown environment</div>';return}

  const methods={};
  for(const[id,d]of Object.entries(allJobData)){
    if(!d.points.length||d.environment!==currentBenchEnv)continue;
    const mKey=d.method;
    const best=Math.max(...d.points.map(p=>p.best_ever));
    const totalEvals=Math.max(...d.points.map(p=>p.evals),d.points.length);
    const runtime=d.started_at&&d.completed_at?dur(d.started_at,d.completed_at):(d.started_at?dur(d.started_at):'â€”');
    if(!methods[mKey]||best>methods[mKey].best)methods[mKey]={key:mKey,name:METHOD_NAMES[mKey]||mKey,best,evals:totalEvals,runtime,solved:best>=bench.threshold,status:d.status};
  }

  const sorted=Object.values(methods).sort((a,b)=>b.best-a.best);
  if(!sorted.length){
    el.innerHTML=`<div class="empty"><div class="empty-icon">${bench.emoji}</div>No results for ${currentBenchEnv}<br><span style="font-size:.75rem">Solved â‰¥ ${bench.threshold} Â· ${bench.obs} obs Â· ${bench.act} act (${bench.type}) ${bench.gpu?'Â· ğŸš€ GPU-native':'Â· ğŸ’» CPU only'}</span></div>`;
    return;
  }

  let h=`<div style="display:flex;gap:12px;flex-wrap:wrap;font-size:.72rem;color:var(--text3);margin-bottom:14px;align-items:center">
    <span>Solved â‰¥ <strong style="color:var(--green)">${bench.threshold}</strong></span>
    <span>obs=${bench.obs} Â· act=${bench.act}</span>
    <span class="badge ${bench.gpu?'badge-gpu':'badge-cpu'}">${bench.type} ${bench.gpu?'GPU':'CPU'}</span>
  </div>`;
  h+='<div class="table-wrap"><table class="table"><thead><tr><th>#</th><th>Method</th><th>Type</th><th>Best Score</th><th>Evals</th><th>Solved</th><th>Runtime</th></tr></thead><tbody>';
  sorted.forEach((m,i)=>{
    const medal=i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':'';
    const rankClass=i<3?`rank-${i+1}`:'';
    const scoreColor=m.solved?'var(--green)':m.best>bench.threshold*0.7?'var(--yellow)':'var(--text)';
    h+=`<tr>
      <td class="${rankClass}">${medal} ${i+1}</td>
      <td style="font-weight:600">${esc(m.name)}</td>
      <td>${methodTypeBadge(m.key)}</td>
      <td style="color:${scoreColor};font-weight:700;font-variant-numeric:tabular-nums;font-family:var(--mono)">${m.best.toFixed(1)}</td>
      <td style="font-variant-numeric:tabular-nums;color:var(--text2)">${fmtNum(m.evals)}</td>
      <td>${m.solved?'<span style="color:var(--green)">âœ“ Solved</span>':'<span style="color:var(--text3)">â€”</span>'}</td>
      <td style="color:var(--text3)">${m.runtime}</td>
    </tr>`;
  });
  h+='</tbody></table></div>';
  setHtml(el,h);
}

// â•â•â•â•â•â•â• BEST SCORES â•â•â•â•â•â•â•
function renderBestScores(){
  const el=document.getElementById('best-scores');
  const envBest={};
  for(const d of Object.values(allJobData)){
    if(!d.points.length)continue;
    const best=Math.max(...d.points.map(p=>p.best_ever));
    if(!envBest[d.environment]||best>envBest[d.environment])envBest[d.environment]=best;
  }
  if(!Object.keys(envBest).length){el.innerHTML='<div class="empty" style="grid-column:1/-1"><div class="empty-icon">ğŸ“Š</div>Run experiments to see scores</div>';return}
  el.innerHTML=Object.entries(envBest).map(([env,s])=>{
    const bench=BENCHMARKS[env]||{threshold:200,emoji:'ğŸ”¬'};
    const ok=s>=bench.threshold;
    return`<div class="stat-card"><div class="stat-val" style="color:${ok?'var(--green)':'var(--text)'}">${s.toFixed(1)}</div><div class="stat-label">${bench.emoji} ${esc(env)}</div>${ok?'<div class="stat-sub" style="color:var(--green)">âœ“ SOLVED</div>':`<div class="stat-sub">${Math.round(s/bench.threshold*100)}% of ${bench.threshold}</div>`}</div>`;
  }).join('');
}

// â•â•â•â•â•â•â• HISTORY â•â•â•â•â•â•â•
function renderHistory(){
  const el=document.getElementById('history-body');
  const filter=document.getElementById('history-env-filter').value;
  let jobs=[...allJobs].sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));
  if(filter!=='all')jobs=jobs.filter(j=>resolveEnv(j)===filter);
  if(!jobs.length){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“‹</div>No jobs</div>';return}
  let h='<div class="table-wrap"><table class="table"><thead><tr><th>ID</th><th>Environment</th><th>Method</th><th>Type</th><th>Status</th><th>Best</th><th>Evals</th><th>Queued</th><th>Runtime</th><th></th></tr></thead><tbody>';
  for(const j of jobs.slice(0,100)){
    const d=allJobData[j.id];
    const best=d&&d.points.length?Math.max(...d.points.map(p=>p.best_ever)).toFixed(1):'â€”';
    const evals=d&&d.points.length?fmtNum(Math.max(...d.points.map(p=>p.evals))):'â€”';
    const bench=BENCHMARKS[j.environment];
    const solved=bench&&d&&d.points.length&&Math.max(...d.points.map(p=>p.best_ever))>=bench.threshold;
    h+=`<tr>
      <td style="font-family:var(--mono);font-size:.7rem;color:var(--text3)">${j.id.slice(0,8)}</td>
      <td style="font-size:.75rem">${esc(j.environment)}</td>
      <td style="font-weight:500">${esc(j.method)}</td>
      <td>${methodTypeBadge(j.method)}</td>
      <td><span class="badge badge-${j.status}">${j.status}</span></td>
      <td style="font-weight:600;font-family:var(--mono);color:${solved?'var(--green)':'var(--text)'}">${best}</td>
      <td style="color:var(--text2)">${evals}</td>
      <td style="font-size:.7rem;color:var(--text3)">${fmtTime(j.created_at)}</td>
      <td style="font-size:.7rem;color:var(--text3)">${dur(j.started_at,j.completed_at)}</td>
      <td><button class="btn-ghost" onclick="downloadCSV('${j.id}')" style="padding:4px 8px;font-size:.65rem">CSV</button></td>
    </tr>`;
  }
  h+='</tbody></table></div>';
  setHtml(el,h);
}

// â•â•â•â•â•â•â• CHARTS â•â•â•â•â•â•â•
function setMetric(btn,m){currentMetric=m;document.querySelectorAll('[data-metric]').forEach(b=>b.classList.remove('active'));btn.classList.add('active');drawLearningCurves()}
function drawAllCharts(){drawComparison();drawSigma();drawDistribution()}

function setupCanvas(id){
  const canvas=document.getElementById(id);
  const wrap=canvas.parentElement;
  const dpr=window.devicePixelRatio||1;
  const w=wrap.clientWidth,h=wrap.clientHeight;
  canvas.width=w*dpr;canvas.height=h*dpr;
  canvas.style.width=w+'px';canvas.style.height=h+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);ctx.clearRect(0,0,w,h);
  return{ctx,w,h};
}

function drawGrid(ctx,pad,w,h,minY,maxY,maxX,xLabel,yLabel,steps=5){
  const pw=w-pad.left-pad.right,ph=h-pad.top-pad.bottom,range=maxY-minY||1;
  ctx.strokeStyle='rgba(255,255,255,.04)';ctx.lineWidth=.5;
  for(let i=0;i<=steps;i++){
    const y=pad.top+(ph/steps)*i;
    ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(w-pad.right,y);ctx.stroke();
    ctx.fillStyle='#5c5c6a';ctx.font='10px -apple-system,sans-serif';ctx.textAlign='right';
    ctx.fillText((maxY-(range/steps)*i).toFixed(0),pad.left-8,y+3);
  }
  ctx.textAlign='center';ctx.fillStyle='#5c5c6a';ctx.font='10px -apple-system,sans-serif';
  for(let i=0;i<=4;i++){const v=Math.round((maxX/4)*i);ctx.fillText(fmtNum(v),pad.left+(v/maxX)*pw,h-pad.bottom+16)}
  ctx.fillStyle='#5c5c6a';ctx.font='10px -apple-system,sans-serif';
  ctx.fillText(xLabel,w/2,h-2);
  ctx.save();ctx.translate(10,h/2);ctx.rotate(-Math.PI/2);ctx.fillText(yLabel,0,0);ctx.restore();
}

function drawSolvedLine(ctx,pad,w,h,minY,maxY,val){
  if(val<minY||val>maxY)return;
  const ph=h-pad.top-pad.bottom,range=maxY-minY||1;
  const y=pad.top+ph-((val-minY)/range)*ph;
  ctx.setLineDash([6,4]);ctx.strokeStyle='rgba(52,211,153,.2)';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(w-pad.right,y);ctx.stroke();ctx.setLineDash([]);
  ctx.fillStyle='rgba(52,211,153,.35)';ctx.font='10px -apple-system,sans-serif';ctx.textAlign='left';
  ctx.fillText(`Solved (${val})`,pad.left+6,y-5);
}

// Method toggles
function buildMethodToggles(entries){
  const el=document.getElementById('method-toggles');
  const methods=new Map();let ci=0;
  for(const[_,d]of entries){if(!methods.has(d.method)){methods.set(d.method,{name:METHOD_NAMES[d.method]||d.method,color:COLORS[ci%COLORS.length],type:methodType(d.method)});ci++}}
  el.innerHTML=[...methods.entries()].map(([key,{name,color,type}])=>{
    const checked=!hiddenMethods.has(key)?'checked':'';
    const icon=type==='backprop'?'âš¡':type==='gpu'?'ğŸš€':'ğŸ§¬';
    return`<label style="display:flex;align-items:center;gap:5px;cursor:pointer;opacity:${hiddenMethods.has(key)?'.35':'1'};transition:opacity .2s"><input type="checkbox" ${checked} onchange="toggleMethod('${key}')" style="accent-color:${color}"><span style="color:${color};font-size:.72rem;font-weight:500">${icon} ${name}</span></label>`;
  }).join('');
}
function toggleMethod(key){if(hiddenMethods.has(key))hiddenMethods.delete(key);else hiddenMethods.add(key);drawLearningCurves()}

// Chart zoom
function initChartZoom(){
  const canvas=document.getElementById('learning-canvas');
  canvas.addEventListener('wheel',e=>{e.preventDefault();const rect=canvas.getBoundingClientRect();const xFrac=(e.clientX-rect.left)/rect.width;const zoomRange=chartZoom.x1-chartZoom.x0;const center=chartZoom.x0+xFrac*zoomRange;const factor=e.deltaY>0?1.2:0.8;const newRange=Math.min(1,zoomRange*factor);chartZoom.x0=Math.max(0,center-xFrac*newRange);chartZoom.x1=Math.min(1,chartZoom.x0+newRange);if(chartZoom.x1-chartZoom.x0>0.99){chartZoom.x0=0;chartZoom.x1=1}drawLearningCurves()},{passive:false});
  canvas.addEventListener('dblclick',()=>{chartZoom.x0=0;chartZoom.x1=1;chartZoom.yOff=0;drawLearningCurves()});
  canvas.addEventListener('mousedown',e=>{if(e.button!==0)return;chartZoom.dragging=true;chartZoom.startX=e.clientX;chartZoom.startY=e.clientY;chartZoom.dragStart={x0:chartZoom.x0,x1:chartZoom.x1,yOff:chartZoom.yOff};e.preventDefault()});
  canvas.addEventListener('mousemove',e=>{if(!chartZoom.dragging)return;const rect=canvas.getBoundingClientRect();const r=chartZoom.dragStart.x1-chartZoom.dragStart.x0;const dx=(e.clientX-chartZoom.startX)/rect.width*r;chartZoom.x0=Math.max(0,Math.min(1-r,chartZoom.dragStart.x0-dx));chartZoom.x1=chartZoom.x0+r;const dy=(e.clientY-chartZoom.startY)/rect.height;chartZoom.yOff=chartZoom.dragStart.yOff+dy;drawLearningCurves()});
  canvas.addEventListener('mouseup',()=>{chartZoom.dragging=false});
  canvas.addEventListener('mouseleave',()=>{chartZoom.dragging=false});
  let lastTouches=null;
  canvas.addEventListener('touchstart',e=>{if(e.touches.length===1){chartZoom.dragging=true;chartZoom.startX=e.touches[0].clientX;chartZoom.startY=e.touches[0].clientY;chartZoom.dragStart={x0:chartZoom.x0,x1:chartZoom.x1,yOff:chartZoom.yOff}}if(e.touches.length===2){chartZoom.dragging=false;lastTouches=[...e.touches]}e.preventDefault()},{passive:false});
  canvas.addEventListener('touchmove',e=>{e.preventDefault();const rect=canvas.getBoundingClientRect();if(e.touches.length===1&&chartZoom.dragging){const r=chartZoom.dragStart.x1-chartZoom.dragStart.x0;const dx=(e.touches[0].clientX-chartZoom.startX)/rect.width*r;chartZoom.x0=Math.max(0,Math.min(1-r,chartZoom.dragStart.x0-dx));chartZoom.x1=chartZoom.x0+r;const dy=(e.touches[0].clientY-chartZoom.startY)/rect.height;chartZoom.yOff=chartZoom.dragStart.yOff+dy;drawLearningCurves()}if(e.touches.length===2&&lastTouches){const prev=Math.hypot(lastTouches[0].clientX-lastTouches[1].clientX,lastTouches[0].clientY-lastTouches[1].clientY);const cur=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);const scale=prev/cur;const cx=((e.touches[0].clientX+e.touches[1].clientX)/2-rect.left)/rect.width;const zr=chartZoom.x1-chartZoom.x0;const center=chartZoom.x0+cx*zr;const nr=Math.max(0.01,Math.min(1,zr*scale));chartZoom.x0=Math.max(0,center-cx*nr);chartZoom.x1=Math.min(1,chartZoom.x0+nr);lastTouches=[...e.touches];drawLearningCurves()}},{passive:false});
  canvas.addEventListener('touchend',e=>{chartZoom.dragging=false;if(e.touches.length<2)lastTouches=null});
}
let chartZoomInited=false;

function drawLearningCurves(){
  if(!chartZoomInited){initChartZoom();chartZoomInited=true}
  const{ctx,w,h}=setupCanvas('learning-canvas');
  const bench=BENCHMARKS[currentBenchEnv]||{threshold:200};
  const allEntries=Object.entries(allJobData).filter(([_,d])=>d.points.length>0&&d.environment===currentBenchEnv);
  buildMethodToggles(allEntries);
  const entries=allEntries.filter(([_,d])=>!hiddenMethods.has(d.method));
  if(!entries.length){ctx.fillStyle='#5c5c6a';ctx.font='13px -apple-system,sans-serif';ctx.textAlign='center';ctx.fillText(`No data for ${currentBenchEnv}`,w/2,h/2);return}

  const pad={top:28,right:24,bottom:40,left:60};
  const pw=w-pad.left-pad.right,ph=h-pad.top-pad.bottom;
  const allPts=entries.flatMap(([_,d])=>d.points);
  const fullMaxGen=Math.max(...allEntries.flatMap(([_,d])=>d.points).map(p=>p.gen),1);
  const visMinGen=Math.floor(chartZoom.x0*fullMaxGen),visMaxGen=Math.ceil(chartZoom.x1*fullMaxGen)||1;
  const visPts=allPts.filter(p=>p.gen>=visMinGen&&p.gen<=visMaxGen);
  const vals=visPts.length?visPts.map(p=>p[currentMetric]||0):[0];
  const rawMaxV=Math.max(Math.max(...vals),bench.threshold*1.1),rawMinV=Math.min(Math.min(...vals),-100);
  const rawRange=rawMaxV-rawMinV||1;
  const yOff=(chartZoom.yOff||0)*rawRange;
  const maxV=rawMaxV+yOff,minV=rawMinV+yOff,range=maxV-minV||1;
  const toX=g=>pad.left+((g-visMinGen)/(visMaxGen-visMinGen||1))*pw;
  const toY=v=>pad.top+ph-((v-minV)/range)*ph;

  drawGrid(ctx,pad,w,h,minV,maxV,visMaxGen,'Generation',currentMetric==='best_ever'?'Best Score':'Mean Score');
  drawSolvedLine(ctx,pad,w,h,minV,maxV,bench.threshold);

  ctx.save();ctx.beginPath();ctx.rect(pad.left,pad.top,pw,ph);ctx.clip();
  const colorMap=new Map();let cj=0;
  for(const[_,d]of allEntries){if(!colorMap.has(d.method)){colorMap.set(d.method,COLORS[cj%COLORS.length]);cj++}}

  for(const[_,d]of entries){
    const color=colorMap.get(d.method)||COLORS[0];
    const pts=d.points.filter(p=>p.gen>=visMinGen&&p.gen<=visMaxGen);
    if(!pts.length)continue;
    // Gradient area fill
    const grad=ctx.createLinearGradient(0,pad.top,0,pad.top+ph);
    grad.addColorStop(0,color+'18');grad.addColorStop(1,color+'02');
    ctx.fillStyle=grad;ctx.beginPath();ctx.moveTo(toX(pts[0].gen),toY(minV));
    pts.forEach(p=>ctx.lineTo(toX(p.gen),toY(p[currentMetric]||0)));
    ctx.lineTo(toX(pts[pts.length-1].gen),toY(minV));ctx.closePath();ctx.fill();
    // Line
    ctx.strokeStyle=color;ctx.lineWidth=2;ctx.lineJoin='round';ctx.beginPath();
    pts.forEach((p,i)=>{const x=toX(p.gen),y=toY(p[currentMetric]||0);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.stroke();
    // Endpoint dot + label
    const last=pts[pts.length-1];
    const lx=toX(last.gen),ly=toY(last[currentMetric]||0);
    ctx.fillStyle=color;ctx.beginPath();ctx.arc(lx,ly,3.5,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=color;ctx.font='bold 10px -apple-system,sans-serif';ctx.textAlign='left';
    ctx.fillText((last[currentMetric]||0).toFixed(1),lx+6,ly+3);
  }
  ctx.restore();
  document.getElementById('chart1-info').textContent=`${entries.reduce((s,[_,d])=>s+d.points.length,0)} points`;
}

function drawComparison(){
  const{ctx,w,h}=setupCanvas('comparison-canvas');
  const methods={};
  for(const d of Object.values(allJobData)){if(!d.points.length)continue;const name=(METHOD_NAMES[d.method]||d.method)+'\n'+d.environment;const best=Math.max(...d.points.map(p=>p.best_ever));if(!methods[name]||best>methods[name].best)methods[name]={best,mean:d.points[d.points.length-1].mean}}
  const names=Object.keys(methods);
  if(!names.length){ctx.fillStyle='#5c5c6a';ctx.font='13px -apple-system,sans-serif';ctx.textAlign='center';ctx.fillText('No data',w/2,h/2);return}
  const pad={top:24,right:20,bottom:56,left:56};const pw=w-pad.left-pad.right,ph=h-pad.top-pad.bottom;
  const vals=[...Object.values(methods).map(m=>m.best),...Object.values(methods).map(m=>m.mean)];
  const maxV=Math.max(Math.max(...vals),300)*1.1,minV=Math.min(Math.min(...vals),-300)*1.1;const range=maxV-minV||1;
  const toY=v=>pad.top+ph-((v-minV)/range)*ph;
  ctx.strokeStyle='rgba(255,255,255,.04)';ctx.lineWidth=.5;for(let i=0;i<=5;i++){const y=pad.top+(ph/5)*i;ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(w-pad.right,y);ctx.stroke();ctx.fillStyle='#5c5c6a';ctx.font='10px -apple-system,sans-serif';ctx.textAlign='right';ctx.fillText((maxV-(range/5)*i).toFixed(0),pad.left-8,y+3)}
  const barW=Math.min(32,pw/(names.length*3)),gap=pw/names.length;
  names.forEach((name,i)=>{const x=pad.left+gap*i+gap/2;const m=methods[name];const yBest=toY(m.best),yZero=toY(0);
    const grad1=ctx.createLinearGradient(0,Math.min(yBest,yZero),0,Math.max(yBest,yZero));
    grad1.addColorStop(0,'#7c6aef');grad1.addColorStop(1,'#7c6aef88');
    ctx.fillStyle=grad1;ctx.beginPath();ctx.roundRect(x-barW-1,Math.min(yBest,yZero),barW,Math.abs(yBest-yZero),[3,3,0,0]);ctx.fill();
    const yMean=toY(m.mean);
    const grad2=ctx.createLinearGradient(0,Math.min(yMean,yZero),0,Math.max(yMean,yZero));
    grad2.addColorStop(0,'#34d399');grad2.addColorStop(1,'#34d39988');
    ctx.fillStyle=grad2;ctx.beginPath();ctx.roundRect(x+1,Math.min(yMean,yZero),barW,Math.abs(yMean-yZero),[3,3,0,0]);ctx.fill();
    ctx.fillStyle='var(--text)';ctx.font='bold 9px -apple-system,sans-serif';ctx.textAlign='center';ctx.fillText(m.best.toFixed(0),x-barW/2,yBest-6);
    ctx.save();ctx.translate(x,h-pad.bottom+8);ctx.rotate(-Math.PI/6);ctx.fillStyle='#9898a4';ctx.font='8px -apple-system,sans-serif';ctx.textAlign='right';ctx.fillText(name.replace('\n',' Â· '),0,0);ctx.restore()});
}

function drawSigma(){
  const{ctx,w,h}=setupCanvas('sigma-canvas');
  const entries=Object.entries(allJobData).filter(([_,d])=>d.points.length>0&&d.points[0].sigma>0);
  if(!entries.length){ctx.fillStyle='#5c5c6a';ctx.font='13px -apple-system,sans-serif';ctx.textAlign='center';ctx.fillText('No sigma data',w/2,h/2);return}
  const pad={top:24,right:20,bottom:40,left:56};const pw=w-pad.left-pad.right,ph=h-pad.top-pad.bottom;
  const allPts=entries.flatMap(([_,d])=>d.points);const maxGen=Math.max(...allPts.map(p=>p.gen),1),maxS=Math.max(...allPts.map(p=>p.sigma),1)*1.1;
  const toX=g=>pad.left+(g/maxGen)*pw,toY=s=>pad.top+ph-(s/maxS)*ph;
  drawGrid(ctx,pad,w,h,0,maxS,maxGen,'Generation','Ïƒ');
  let ci=0;for(const[_,d]of entries){const color=COLORS[ci%COLORS.length];ctx.strokeStyle=color;ctx.lineWidth=1.5;ctx.lineJoin='round';ctx.beginPath();d.points.forEach((p,i)=>{i===0?ctx.moveTo(toX(p.gen),toY(p.sigma)):ctx.lineTo(toX(p.gen),toY(p.sigma))});ctx.stroke();const last=d.points[d.points.length-1];ctx.fillStyle=color;ctx.font='9px -apple-system,sans-serif';ctx.textAlign='left';ctx.fillText((METHOD_NAMES[d.method]||d.method)+' ('+last.sigma.toFixed(3)+')',toX(last.gen)+6,toY(last.sigma));ci++}
}

function drawDistribution(){
  const{ctx,w,h}=setupCanvas('dist-canvas');
  const entries=Object.entries(allJobData).filter(([_,d])=>d.points.length>0);
  if(!entries.length){ctx.fillStyle='#5c5c6a';ctx.font='13px -apple-system,sans-serif';ctx.textAlign='center';ctx.fillText('No data',w/2,h/2);return}
  const pad={top:24,right:20,bottom:40,left:60};const pw=w-pad.left-pad.right,ph=h-pad.top-pad.bottom;
  const allPts=entries.flatMap(([_,d])=>d.points);const maxGen=Math.max(...allPts.map(p=>p.gen),1);
  const allVals=[...allPts.map(p=>p.best_ever),...allPts.map(p=>p.mean)];const maxV=Math.max(...allVals)*1.1,minV=Math.min(...allVals)*1.1;const range=maxV-minV||1;
  const toX=g=>pad.left+(g/maxGen)*pw,toY=v=>pad.top+ph-((v-minV)/range)*ph;
  drawGrid(ctx,pad,w,h,minV,maxV,maxGen,'Generation','Score');
  let ci=0;for(const[_,d]of entries){const color=COLORS[ci%COLORS.length];
    const grad=ctx.createLinearGradient(0,pad.top,0,pad.top+ph);
    grad.addColorStop(0,color+'20');grad.addColorStop(1,color+'04');
    ctx.fillStyle=grad;ctx.beginPath();d.points.forEach((p,i)=>{i===0?ctx.moveTo(toX(p.gen),toY(p.best_ever)):ctx.lineTo(toX(p.gen),toY(p.best_ever))});for(let i=d.points.length-1;i>=0;i--)ctx.lineTo(toX(d.points[i].gen),toY(d.points[i].mean));ctx.closePath();ctx.fill();ctx.strokeStyle=color;ctx.lineWidth=1.5;ctx.lineJoin='round';ctx.beginPath();d.points.forEach((p,i)=>{i===0?ctx.moveTo(toX(p.gen),toY(p.best_ever)):ctx.lineTo(toX(p.gen),toY(p.best_ever))});ctx.stroke();ci++}
}

// â•â•â•â•â•â•â• METHOD PARAMS â•â•â•â•â•â•â•
const METHOD_PARAMS = {
  _common:[{key:'max_evals',label:'Max Evals',type:'number',default:100000,step:10000},{key:'eval_episodes',label:'Episodes',type:'number',default:5,step:1}],
  cma_es:[{key:'sigma0',label:'Ïƒâ‚€',type:'number',default:0.5,step:0.1},{key:'patience',label:'Patience',type:'number',default:200,step:50}],
  openai_es:[{key:'pop_size',label:'Pop Size',type:'number',default:50,step:10},{key:'lr',label:'LR',type:'number',default:0.02,step:0.005},{key:'noise_std',label:'Noise Ïƒ',type:'number',default:0.1,step:0.01}],
  curriculum:[{key:'sigma0',label:'Ïƒâ‚€',type:'number',default:0.5,step:0.1}],
  neuromod:[{key:'sigma0',label:'Ïƒâ‚€',type:'number',default:0.5,step:0.1}],
  island_model:[{key:'n_islands',label:'Islands',type:'number',default:4,step:1},{key:'migration_interval',label:'Migrate Int',type:'number',default:10,step:5},{key:'sigma0',label:'Ïƒâ‚€',type:'number',default:0.5,step:0.1}],
  meta_learning:[{key:'sigma0',label:'Ïƒâ‚€',type:'number',default:0.5,step:0.1}],
  gpu_full_cma_es:[{key:'sigma0',label:'Ïƒâ‚€',type:'number',default:0.5,step:0.1},{key:'patience',label:'Patience',type:'number',default:200,step:50}],
  gpu_full_openai_es:[{key:'pop_size',label:'Pop Size',type:'number',default:50,step:10},{key:'lr',label:'LR',type:'number',default:0.02,step:0.005},{key:'noise_std',label:'Noise Ïƒ',type:'number',default:0.1,step:0.01}],
  gpu_full_benchmark:[{key:'n_candidates',label:'Candidates',type:'number',default:28,step:4}],
  ppo_baseline:[{key:'rollout_steps',label:'Rollout',type:'number',default:2048,step:256},{key:'n_epochs',label:'Epochs',type:'number',default:10,step:1},{key:'lr',label:'LR',type:'number',default:0.0003,step:0.0001},{key:'clip_eps',label:'Clip Îµ',type:'number',default:0.2,step:0.05}],
};

function updateMethodParams(){
  const method=document.getElementById('method-select').value;
  const el=document.getElementById('method-params');
  const fields=[...(METHOD_PARAMS._common||[]),...(METHOD_PARAMS[method]||[])];
  el.innerHTML=fields.map(f=>{
    const id=`param-${f.key}`;
    if(f.type==='select'){const opts=(f.options||[]).map(o=>`<option value="${o}"${o===f.default?' selected':''}>${o}</option>`).join('');return`<div class="form-group"><label>${esc(f.label)}</label><select id="${id}" class="form-select">${opts}</select></div>`}
    return`<div class="form-group"><label>${esc(f.label)}</label><input type="number" id="${id}" class="form-input" value="${f.default}" step="${f.step||1}"></div>`;
  }).join('');
}
setTimeout(updateMethodParams,0);

// â•â•â•â•â•â•â• ACTIONS â•â•â•â•â•â•â•
async function submitJob(){
  const environment=document.getElementById('env-select').value;
  const method=document.getElementById('method-select').value;
  const fields=[...(METHOD_PARAMS._common||[]),...(METHOD_PARAMS[method]||[])];
  const params={};
  for(const f of fields){const el=document.getElementById(`param-${f.key}`);if(!el)continue;let v=el.value;if(f.type==='number')v=parseFloat(v);if(v!==''&&v!==null&&!isNaN(v))params[f.key]=v}
  try{const r=await fetch('/api/jobs/submit',{method:'POST',headers:{'Authorization':'Bearer '+TOKEN,'Content-Type':'application/json'},body:JSON.stringify({method,environment,max_evals:params.max_evals||100000,params})});if(r.ok){addLog(`ğŸ“¤ <b>${esc(method)}</b> on ${esc(environment)}`);refresh()}else{const t=await r.text();addLog('âŒ Submit failed: '+t)}}catch(e){addLog('âŒ '+e)}
}
async function cancelJob(id){if(!confirm('Cancel job '+id.slice(0,8)+'?'))return;try{await fetch(`/api/jobs/cancel/${id}`,{method:'POST',headers:{'Authorization':'Bearer '+TOKEN}});addLog('ğŸš« Cancelled '+id.slice(0,8));refresh()}catch(e){}}
async function toggleWorker(id){try{await fetch(`/api/workers/${id}/enable`,{method:'POST',headers:{'Authorization':'Bearer '+TOKEN}});refresh()}catch(e){}}

// â•â•â•â•â•â•â• EXPORT â•â•â•â•â•â•â•
async function downloadCSV(id){try{const r=await fetch(`/api/results/${id}/csv`,{headers:{'Authorization':'Bearer '+TOKEN}});dl(await r.text(),'text/csv',`gaia-${id.slice(0,8)}.csv`)}catch(e){}}
function downloadAllCSV(){let csv='job_id,method,env,gen,best,best_ever,mean,sigma,evals,time\n';for(const[id,d]of Object.entries(allJobData))for(const p of d.points)csv+=`${id.slice(0,8)},${d.method},${d.environment},${p.gen},${p.best},${p.best_ever},${p.mean},${p.sigma},${p.evals},${p.time}\n`;dl(csv,'text/csv','gaia-all.csv')}
function downloadSummaryJSON(){const s={};for(const[id,d]of Object.entries(allJobData)){if(!d.points.length)continue;s[d.method+'@'+d.environment]={method:d.method,env:d.environment,best:Math.max(...d.points.map(p=>p.best_ever)),evals:Math.max(...d.points.map(p=>p.evals))}};dl(JSON.stringify(s,null,2),'application/json','gaia-summary.json')}
function dl(c,t,n){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:t}));a.download=n;a.click()}

// â•â•â•â•â•â•â• NETWORK â•â•â•â•â•â•â•
async function renderNetwork(){
  const el=document.getElementById('network-body');
  try{const r=await fetch('/api/network',{headers:{'Authorization':'Bearer '+TOKEN}});if(!r.ok)throw new Error('HTTP '+r.status);const d=await r.json();
    if(d.mode==='centralized'){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸ—ï¸</div><div style="font-weight:600;margin-bottom:4px">Centralized Mode</div><div style="color:var(--text3);font-size:.8rem">Start with <code style="background:var(--surface2);padding:2px 8px;border-radius:4px;font-family:var(--mono)">--gossip</code> to enable P2P networking</div></div>';return}
    let h=`<div class="stats-row"><div class="stat-card"><div class="stat-val" style="color:var(--accent)">${d.peer_count}</div><div class="stat-label">Peers</div></div><div class="stat-card"><div class="stat-val" style="color:var(--green)">${d.gpu_nodes}</div><div class="stat-label">GPU Nodes</div></div><div class="stat-card"><div class="stat-val" style="color:var(--cyan)">${d.total_cpu_cores}</div><div class="stat-label">CPU Cores</div></div></div>`;
    if(d.peers?.length){h+='<div class="table-wrap"><table class="table"><thead><tr><th>Node</th><th>Address</th><th>GPU</th><th>CPU</th><th>Last Seen</th></tr></thead><tbody>';for(const p of d.peers){const c=p.capabilities||{};h+=`<tr><td style="color:var(--accent);font-family:var(--mono);font-size:.75rem">${esc(p.node_id.slice(0,12))}â€¦</td><td>${esc(p.address)}</td><td>${c.gpu?'ğŸŸ¢ '+esc(c.gpu):'â€”'}</td><td>${c.cpu_cores||'?'}</td><td>${timeSince(p.last_seen)}</td></tr>`}h+='</tbody></table></div>'}
    setHtml(el,h);
  }catch(e){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸŒ</div>Network unavailable</div>'}
}

window.addEventListener('resize',()=>{if(document.getElementById('tab-benchmarks').classList.contains('active'))drawLearningCurves();if(document.getElementById('tab-charts').classList.contains('active'))drawAllCharts()});
</script>
</body>
</html>
